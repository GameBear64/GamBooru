<!-- <pre>{{ tag | json }}</pre> -->
<!-- <pre>{{ mAuth | json }}</pre> -->

<div class="tagPage">
  <div class="description">
    <h1>{{ tag?.name }}</h1>
    <p>{{ tag?.description }}</p>
    <p>
      Category: <b>{{ tag?.category }}</b>
    </p>
    <p>
      Post count: <b>{{ tag?.count }}</b>
    </p>
    <div
      *ngIf="mAuth?.loggedIn?.user"
      class="w3-panel w3-pale-blue w3-leftbar w3-rightbar w3-border-blue w3-padding-16 lockedStatus"
    >
      <div *ngIf="tag?.lockVotes?.length < 10; else locked">
        <p>
          This tag can be edited freely, feel free to provide more information
          about the subject.
        </p>
        <p>If you think this tag is perfect as it is, vote to lock it.</p>
        <div class="actions w3-padding-top-24">
          <button
            (click)="toggleEdit()"
            class="w3-button w3-padding-small w3-blue w3-round"
          >
            Edit
          </button>
          <button
            (click)="voteLock()"
            class="w3-button w3-padding-small w3-green w3-round"
          >
            Vote Lock
          </button>
          <button
            (click)="delete()"
            class="w3-button w3-padding-small w3-red w3-round"
          >
            Vote Delete
          </button>
        </div>
      </div>
      <ng-template #locked>
        <div class="lockedStatus">
          <p>This tag has been locked by a moderator and cannot be edited.</p>
        </div>
      </ng-template>
    </div>

    <div *ngIf="editMode">
      <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
        <label for="name">Name</label><br />
        <input formControlName="name" name="name" trim="blur" />
        <br />
        <span *ngIf="f?.['name']?.invalid && f?.['name']?.touched">
          Invalid name (minimum 3 chars)
          <br />
        </span>
        <br />
        <label for="description">Description</label><br />
        <textarea formControlName="description" name="description" trim="blur">
        </textarea>
        <br />
        <span
          *ngIf="f?.['description']?.invalid && f?.['description']?.touched"
        >
          Invalid description ({{
            50 - (editForm.value.description?.length || 50)
          }}
          more characters)
          <br />
        </span>
        <br />
        <label for="category">Category</label><br />
        <select formControlName="category" name="category">
          <option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </option>
        </select>
        <br />
        <br />
        <button class="button" type="submit" [disabled]="editForm.invalid">
          Update
        </button>
      </form>
    </div>
  </div>
  <div class="examples">
    <h4>Example images:</h4>
    <div>
      <a
        *ngFor="let post of tag?.example"
        [routerLink]="['/gallery', post._id]"
      >
        <img [src]="post.image?.thumbnail" class="w3-round" />
      </a>
    </div>
  </div>
</div>
